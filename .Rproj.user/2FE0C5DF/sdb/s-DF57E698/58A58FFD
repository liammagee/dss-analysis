{
    "collab_server" : "",
    "contents" : "library(readxl)\nlibrary(tidyverse)\nlibrary(ggplot2)\nlibrary(lubridate)\nlibrary(reshape2)\n\ndf <- data.frame('Date'=lubridate::ymd(), 'Partial.NS'=integer(), 'Total.NS'=integer(), 'Total.DSP'=integer())\n\n\naddPeriod <- function(df, file, year, month, sheetTotal = 4, sheetPartial = 19) {\n  period.ALL <- read_excel(file, sheetTotal)\n  period.NS <- read_excel(file, sheetPartial)\n  \n  dsp.total <- as.numeric(period.ALL$X__9[12])\n  ns.total <- as.numeric(period.ALL$X__15[12])\n  ns.partial <- as.numeric(period.NS$X__2[3])\n  df %>% add_row('Partial.NS'=ns.partial, 'Total.NS'=ns.total, 'Total.DSP'=dsp.total, 'Date' = ymd(paste(year, '/', month, '/', 1)) )\n}\n\n    \n    \ndf <- addPeriod(df, 'dss-payment-demographics-dataset-december-2018.xlsx', 2018, 12)\ndf <- addPeriod(df, 'dssdemographics-september-2018-conf.xlsx', 2018, 9, sheetPartial = 18)\ndf <- addPeriod(df, 'dss-demographics-june-2018.xlsx', 2018, 6)\ndf <- addPeriod(df, 'dss-demographics-march-2018.xlsx', 2018, 3)\n\ndf <- addPeriod(df, 'dss-demographics-december-2017.xlsx', 2017, 12)\ndf <- addPeriod(df, 'dss-demographics-september-2017.xlsx', 2017, 9)\ndf <- addPeriod(df, 'dss-demographics-june-2017.xlsx', 2017, 6)\ndf <- addPeriod(df, 'dss-demographics-march-2017.xlsx', 2017, 3)\n\ndf <- addPeriod(df, 'dss-demographics-december-2016.xlsx', 2016, 12)\ndf <- addPeriod(df, 'dss-demographics-september-2016.xlsx', 2016, 9, sheetPartial = 18)\ndf <- addPeriod(df, 'dss-demographics-june-2016.xlsx', 2016, 6, sheetPartial = 18)\ndf <- addPeriod(df, 'dss-demographics-march-2016.xlsx', 2016, 3, sheetPartial = 18)\n\ndf <- addPeriod(df, 'demographics-december-2015-conf.xlsx', 2015, 12, sheetPartial = 18)\ndf <- addPeriod(df, '201509-dssdemographics.xlsx', 2015, 9, sheetPartial = 18)\ndf <- addPeriod(df, 'dss-demographics-june-2015.xlsx', 2015, 6, sheetPartial = 18)\ndf <- addPeriod(df, 'dss-demogrphics-march-2015.xlsx', 2015, 3, sheetPartial = 18)\n\ndf <- addPeriod(df, 'dssdemographicdecember2014.xlsx', 2014, 12, sheetTotal = 2, sheetPartial = 14)\ndf <- addPeriod(df, 'dssdemographicsseptember2014.xlsx', 2014, 9, sheetTotal = 2, sheetPartial = 14)\ndf <- addPeriod(df, 'june-2014-dss-demographics-suppressed-2014-final-ftb.xlsx', 2014, 6, sheetTotal = 2, sheetPartial = 14)\n#df <- addPeriod(df, 'dssdemographicsmarch2014.xlsx', 'Mar14', 2014, 3, sheetTotal = 2, sheetPartial = 14)\n\n#df <- addPeriod(df, 'dssdemographicsseptember2013.xlsx', 'Dec13', 2013, 12, sheetTotal = 2, sheetPartial = 14)\n#df <- addPeriod(df, 'dssdemographicsseptember2013.xlsx', 'Sep13', 2013, 9, sheetTotal = 2, sheetPartial = 14)\n\ndf$Diff.DSP <- df$Total.DSP - df[length(df$Total.DSP),'Total.DSP']\ndf$Diff.Partial.NS <- df$Partial.NS - df[length(df$Partial.NS),'Partial.NS']\n\ndf$Diff.of.Diffs <- df$Diff.Partial.NS - df$Diff.DSP\n \ndfm <- melt(df, id.vars = c(\"Date\"), measure.vars = c('Total.DSP', 'Total.NS', 'Partial.NS', 'Diff.of.Diffs'))\ndfm$strdate <- strftime(dfm$Date, \"%b %y\")\n\n\np<-ggplot(data=dfm, aes(x=reorder(strdate, Date), y=value / 1000)) +\n  geom_bar(stat=\"identity\", aes(fill=variable), width = 0.5, position=position_dodge(width = 0.8)) +\n  theme_bw()  +\n  scale_x_discrete(breaks = dfm$strdate, labels = dfm$strdate) +\n  scale_y_continuous(breaks = c(0, 200, 400, 600, 800), labels = paste(c(0, 200, 400, 600, 800), 'K', sep='')) +\n  scale_fill_brewer(palette=\"Dark2\", name = \"\", labels = c(\"Disability Support Pension\", \n                                            \"Newstart recipients\", \n                                            \"Newstart recipients with partial capacity to work\", \n                                            \"Shift from DSP to Newstart, with partial capacity to work\")) +\n  labs(x = \"\", y=\"\") +\n  theme(\n    legend.position=\"bottom\",\n    legend.direction = \"vertical\",\n        axis.text.x = element_text(angle = 45, vjust = 0.5, hjust = 0.75),\n        axis.text.y = element_text())\n\np\n\nggsave(\"chart.png\")\n",
    "created" : 1565821971940.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1737695374",
    "id" : "58A58FFD",
    "lastKnownWriteTime" : 1565872008,
    "last_content_update" : 1565872008,
    "path" : "~/Dev/dss/chart.R",
    "project_path" : "chart.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}